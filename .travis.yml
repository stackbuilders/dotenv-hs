---
language: haskell

ghc:
  - "8.6"
  - "8.4"
  - "8.2"
  - "8.0"
  - "7.10"

before_deploy: |
  if [[ $TRAVIS_HASKELL_VERSION == "8.6.5" ]]; then
    cabal install -f 'static'
    tar -C dist/build/dotenv -cvf dotenv-linux-x86_64-static.tar.gz dotenv
    curl https://github.com/lindell/github-release-cli/releases/download/1.3.0/github-releaser-travis -L --output github-releaser && chmod +x github-releaser
    export GITHUB_OAUTH_TOKEN="$GITHUB_TRAVIS_DEPLOY"
    export RELEASE_NAME=Dotenv-Release-v$(cabal exec dotenv -- --version)
    export BODY=$(envsubst < ./CHANGELOG.md)
    export FILES=dotenv-linux-x86_64-static.tar.gz
  fi

deploy:
  provider: script
  script: ./github-releaser -draft -verbose
  skip_cleanup: true
  on:
    condition: $TRAVIS_HASKELL_VERSION == "8.6.5"
    tags: true
